# OpenAI API Key for AI-powered step interpretation
OPENAI_API_KEY=your_openai_api_key_here

# Jira Configuration (optional)
JIRA_BASE_URL=https://your-domain.atlassian.net
JIRA_EMAIL=your-email@example.com
JIRA_API_TOKEN=your_jira_api_token_here

# Server Configuration
PORT=3001

import asyncio
import websockets
from browser_use import Agent, ChatOpenAI
from oauth import get_oauth_token

WS_URL = "ws://localhost:9001"

COMPANY_BASE_URL = "https://your-company-llm-base-url"
COMPANY_MODEL = "your-model-name"


async def wait_for_page(agent):
    while not agent.browser.context.pages:
        await asyncio.sleep(0.1)
    return agent.browser.context.pages[0]


async def stream_browser(page):
    async with websockets.connect(WS_URL) as ws:
        while True:
            frame = await page.screenshot(type="jpeg", quality=60)
            await ws.send(frame)
            await asyncio.sleep(0.25)  # ~4 FPS (LIVE)


async def main():
    # 1. OAuth token
    token = get_oauth_token()

    # 2. LLM FROM browser-use (important)
    llm = ChatOpenAI(
        base_url=COMPANY_BASE_URL,
        model=COMPANY_MODEL,
        default_headers={
            "Authorization": f"Bearer {token}"
        }
    )

    # 3. browser-use Agent
    agent = Agent(
        task="Open google.com and search browser-use",
        llm=llm,
        headless=True
    )

    # 4. Start automation
    agent_task = asyncio.create_task(agent.run())

    # 5. Get Playwright page
    page = await wait_for_page(agent)

    # 6. Mask password fields (SECURITY)
    await page.add_style_tag(
        content='input[type="password"] { filter: blur(10px); }'
    )

    # 7. Start live streaming
    stream_task = asyncio.create_task(stream_browser(page))

    await agent_task
    stream_task.cancel()


asyncio.run(main())



_____&_____

{
  "name": "browser-stream",
  "type": "module",
  "dependencies": {
    "ws": "^8.16.0"
  }
}

___&____

import WebSocket, { WebSocketServer } from "ws";

const wss = new WebSocketServer({ port: 9001 });
let viewers = [];

wss.on("connection", (ws) => {
  viewers.push(ws);
  console.log("Viewer connected");

  ws.on("message", (data) => {
    viewers.forEach(v => {
      if (v.readyState === WebSocket.OPEN) {
        v.send(data);
      }
    });
  });

  ws.on("close", () => {
    viewers = viewers.filter(v => v !== ws);
  });
});

console.log("WebSocket server running on ws://localhost:9001");



____&____

<!DOCTYPE html>
<html>
<head>
  <title>Live Browser Automation</title>
</head>
<body>

<h2>Live Automation View</h2>
<img id="view" style="width:100%; border:1px solid #aaa;" />

<script>
const ws = new WebSocket("ws://localhost:9001");
ws.binaryType = "blob";

ws.onmessage = (e) => {
  const url = URL.createObjectURL(e.data);
  document.getElementById("view").src = url;
};
</script>

</body>
</html>


__&___
