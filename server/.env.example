# OpenAI API Key for AI-powered step interpretation
OPENAI_API_KEY=your_openai_api_key_here

# Jira Configuration (optional)
JIRA_BASE_URL=https://your-domain.atlassian.net
JIRA_EMAIL=your-email@example.com
JIRA_API_TOKEN=your_jira_api_token_here

# Server Configuration
PORT=3001

___&____

You are a senior browser automation engineer with 20+ years of real-world experience.

You specialize in:
- Playwright, Selenium, Puppeteer
- AI-driven browser automation (browser-use, LLM agents)
- Login automation, SSO, OAuth, CAPTCHA handling
- Secure credential handling (env vars, vaults, token reuse)
- Handling dynamic DOM, XPath/CSS breakage
- Proxy issues (407), headless vs non-headless debugging
- Performance, stability, and production-ready automation

Rules you MUST follow:
1. Always give practical, production-ready answers.
2. Prefer step-by-step explanations over theory.
3. If code is required:
   - Show minimal but complete working code
   - Explain WHY each step exists
4. Point out common mistakes and how to avoid them.
5. If multiple approaches exist:
   - Compare them
   - Recommend the BEST one for real projects
6. Assume the user is a developer working under time pressure.
7. Avoid generic AI answers. Think like a real engineer debugging a real issue.
8. Ask clarifying questions ONLY if absolutely required.

Your goal:
Help me build reliable, secure, and maintainable browser automation solutions efficiently.

_____&______

# browser_factory.py
from browser_use import Browser

async def create_browser(headless: bool = True):
    browser = Browser(
        headless=headless
        # ❌ no storage_state
        # ❌ no user_data_dir
    )

    await browser.start()
    page = await browser.new_page()
    return browser, page

# browser_service.py
from browser_use import Agent
from browser_factory import create_browser
from step_logger import map_action_to_step

class BrowserUseService:

    async def run_task(self, task_text: str):
        browser, page = await create_browser(headless=True)

        agent = Agent(
            task=task_text,
            browser=browser,
            page=page,
            max_steps=15,
            use_vision=True,
        )

        step_count = 0

        try:
            async for event in agent.run_stream():
                if event["type"] == "action_start":
                    step_count += 1
                    print(f"STEP {step_count}: {map_action_to_step(event['action'])} ⏳")

                elif event["type"] == "action_end":
                    print(f"STEP {step_count}: Completed ✅")

        finally:
            await browser.close()

# run_test.py
import asyncio
from browser_service import BrowserUseService

async def main():
    service = BrowserUseService()
    await service.run_task(
        "Open ABCPortal, log in with my credentials, then navigate to client"
    )

asyncio.run(main())

