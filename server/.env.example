# OpenAI API Key for AI-powered step interpretation
OPENAI_API_KEY=your_openai_api_key_here

# Jira Configuration (optional)
JIRA_BASE_URL=https://your-domain.atlassian.net
JIRA_EMAIL=your-email@example.com
JIRA_API_TOKEN=your_jira_api_token_here

# Server Configuration
PORT=3001

import os
import requests
from dotenv import load_dotenv

load_dotenv()

class OAuthClient:
    def get_access_token(self) -> str:
        res = requests.post(
            os.getenv("TOKEN_URL"),
            data={
                "grant_type": "client_credentials",
                "client_id": os.getenv("CLIENT_ID"),
                "client_secret": os.getenv("CLIENT_SECRET")
            },
            timeout=10
        )
        res.raise_for_status()
        return res.json()["access_token"]

___&&___

import os
from browser_use import Agent

def create_agent(nlp_task: str, auth_key: str):
    """
    Creates NLP-driven agent.
    NLP comes from user input.
    No secrets here.
    """

    return Agent(
        task=nlp_task,
        auth_key=auth_key,
        model=os.getenv("LLM_MODEL"),
        base_url=os.getenv("LLM_BASE_URL"),
        headers={
            "X-Tenant-Id": os.getenv("TENANT_ID", "")
        },
        verbose=True
    )
___&____


import os

def secure_login_interceptor(action, page):
    if action.type != "fill":
        return False

    sel = action.selector.lower()

    if "user" in sel or "email" in sel or "login" in sel:
        page.fill(action.selector, os.getenv("PORTAL_USERNAME"))
        return True

    if "pass" in sel:
        page.fill(action.selector, os.getenv("PORTAL_PASSWORD"))
        return True

    return False

___&___



import os
from dotenv import load_dotenv

from browser_use import Browser
from oauth import OAuthClient
from agent_factory import create_agent
from secure_login_interceptor import secure_login_interceptor

load_dotenv()

def main():
    # üîπ USER INPUT (NLP)
    print("\nEnter NLP command:")
    nlp_command = input("> ")

    # üîπ Get LLM auth token (internal)
    oauth = OAuthClient()
    auth_key = oauth.get_access_token()

    # üîπ Browser start
    browser = Browser(headless=False)
    page = browser.new_page()
    page.goto(os.getenv("PORTAL_URL"))

    # üîπ Create agent from NLP
    agent = create_agent(nlp_command, auth_key)

    # üîπ Execute with security interception
    for action in agent.run(page):
        if not secure_login_interceptor(action, page):
            action.execute(page)

    print("\n‚úÖ NLP automation completed securely")

if __name__ == "__main__":
    main()

import os
from dotenv import load_dotenv

from browser_use import Browser
from oauth import OAuthClient
from agent_factory import create_agent

load_dotenv()

def main():
    # 1Ô∏è‚É£ NLP input (ONLY thing user provides)
    print("\nEnter NLP command:")
    nlp_command = input("> ")

    # 2Ô∏è‚É£ Get LLM OAuth token
    oauth = OAuthClient()
    auth_key = oauth.get_access_token()

    # 3Ô∏è‚É£ Create Browser WITH auth_key ‚úÖ
    browser = Browser(
        auth_key=auth_key,                 # üîê REQUIRED
        model=os.getenv("LLM_MODEL"),
        base_url=os.getenv("LLM_BASE_URL"),
        headers={
            "X-Tenant-Id": os.getenv("TENANT_ID", "")
        },
        storage_state="sso_session.json",  # SSO reuse
        headless=False
    )

    # 4Ô∏è‚É£ Create page
    page = browser.new_page()

    # 5Ô∏è‚É£ Navigate
    page.goto(os.getenv("PORTAL_URL"))

    # 6Ô∏è‚É£ Create Agent
    agent = create_agent(nlp_command, auth_key)

    # 7Ô∏è‚É£ Run NLP automation
    for action in agent.run(page):
        action.execute(page)

    print("‚úÖ NLP automation completed (SSO secure)")

if __name__ == "__main__":
    main()
